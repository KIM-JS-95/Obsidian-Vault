# 스패닝 트리의 5가지 상태 변화 /  STP 재편성

STP는 5가지의 과정을 통해 여러 스위치가 하나의 트리로 구성될 수 있다.

이는 하나의 생명주기와 유사하며 새로운 `BPDU`이 감지되다면, 다시말해 새로운 스위치의
접근이 확인된다면 5가지의 과정을 다시 반복하게되며 각 상태에서 예외사항이 발생할 경우
특정 단계로 돌아가 다시 작업을 시작하게 된다.



## 5가지 상태
- Disable
  - 스위치의 전원이 없거나 사용할 수 없는 상태


- Blocking
  - 스위치의 사용이 확인되고 해당 스위치의 `BPD`가 각 스위치와 교환되는 상태
    - 이 단계에서 ROOT BRIDGE, ROOT PORT, DESIGNATED, Non-DESIGNATED 가 선출되어 하나의 트리가 생성되는 단계
    - `BPD` 만 교환하며 Mac정보와 일반데이터 정보는 교환 X


- Listening
  - 이전 블로킹 상태가 종료된 상태로 
  주관적인 해석으로 리스닝 상태를 `15초간` 대기하며 구성된 스패닝 트리를 검증하는 상태로 해석한다. <br><br> 이 뜻은 언제든지 새로운 `BPD`의 접근이 확인될 수 있으며 이 경우 이전 단계 블록킹 단계로 돌아가 작업을 반복하게 된다.
  
- Learning
  - 최초로 `Mac-address`를 학습하는 단계로 이 단계에서 `Root switch`는 맥 어드레스 테이블(브릿지 테이블)을 생성한다.
  - 해당 단계 또한 `15초`동안 상태를 유지한다.

- Forwarding
  - 데이터 교환을 위한 최종 상태


## STP 재편성

모든 스위치가 정상적으로 통신이 이루어지는 도중 세그먼트가 끊어지는 상황이 발생한다면 ROOT BRIDGE가 보내는 정보를 세그먼트의 주인 스위치는 받지 못하게 될것이다.

이 경우 해당 스위치는 자신의 `MAX Age`를 카운트 하여 대기상태에 들어가게되고 정해진 시간동안 정보가 들어오지 않는다면
해당 스위치가 가지는 또 다른 포트 `Non-Designated` 포트를 개방하여 5가지 상태변화를 통해 새로운 스패닝 트리를 구성한다.


### 새로운 스패닝 트리가 가지는 딜레이 타임의 문제
5가지 상태를 지나기 위해서는 기본적으로 약 `3단계 + 4단계`의 과정을 통해 총 30초 간의 정보를 교환학 되는데
트리를 재편성 할 경우 `Max_Age + 3단계 + 4단계`의 과정에서 총 50초의 딜레이가 발생하게된다.

이러한 문제를 개선하기위해 RSTP(Rapid Spanning Tree Protocol), Port-fast, UpLink-Fast 등의 해결책이 개발되어진다.
